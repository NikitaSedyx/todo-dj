!function(){angular.module("todo",["ngResource","ui.router","ui.bootstrap","nm-widgets","monospaced.elastic","infinite-scroll","downloaders"])}(),function(){angular.module("downloaders",[])}(),function(){angular.module("nm-widgets",[])}(),function(){angular.module("todo").config(function(o){o.defaults.xsrfCookieName="csrftoken",o.defaults.xsrfHeaderName="X-CSRFToken"}).config(function(o,t){o.interceptors.push(function(o,t){return{responseError:function(e){if(401!==e.status)return e;var r=t.get("$state");return r.go("login"),o.reject(e)}}})})}(),function(){angular.module("todo").constant("API",{BASE:"/api/v1",AUTH:"/auth/",REGISTRATION:"/registration/",GROUP:"/group/",EXPORT:"/export/",USER:"/user/",ITEM:"/item/"})}(),function(){function o(o,t){t.otherwise("/groups"),o.state("groups",{"abstract":!0,templateUrl:"app/views/components/groups/groups.html",controller:"GroupController"}).state("groups.list",{url:"/groups",views:{list:{templateUrl:"app/views/components/groups/group-list/group-list.html",controller:"GroupListController"},panel:{templateUrl:"app/views/components/groups/group-panel/group-panel.html",controller:"GroupPanelController"}}}).state("edit-group",{url:"/edit_group/:id",templateUrl:"app/views/components/groups/group-edit/edit-group.html",controller:"EditGroupController",resolve:{groupId:function(o,t){return o.id}}})}angular.module("todo").config(o),o.$injector=["$stateProvider","$urlRouterProvider"]}(),function(){function o(o,t){return t(o.BASE+o.ITEM+"/:id/",{id:"@id"},{getItem:{method:"GET"},createItem:{method:"POST"},updateItem:{method:"PUT"},deleteItem:{method:"DELETE"}})}angular.module("todo").service("ItemResource",o),o.$inject=["API","$resource"]}(),function(){function o(o){o.user=null}angular.module("todo").controller("LogoutController",o),o.$inject=["$scope"]}(),function(){function o(o,t){return t(o.BASE+o.USER+":id/",{id:"@id"},{getUsers:{method:"GET",params:{id:null}},getUser:{method:"GET"},createUser:{method:"POST"},updateUser:{method:"PUT"},deleteUser:{method:"DELETE"}})}angular.module("todo").factory("UserResource",o),o.$inject=["API","$resource"]}(),function(){angular.module("todo").service("GroupStorage",function(o){function t(o){var t="panel";u[t](o)}function e(t){o.getGroups(t).$promise.then(function(o){n.groups.data=o.objects,n.groups.totalItems=o.meta.total_count})}function r(t){o.getGroups(t).$promise.then(function(o){_.forEach(o.objects,function(o){n.groups.data.push(o)})})}var n=this;n.groups={data:[],totalItems:0},n.loadData=t;var u={list:e,panel:r}})}(),function(){function o(o,t){function e(){t.params.offset=0,o.groups.data=[]}t.groupView="list",t.groups=o.groups,t.params={offset:0},t.changeGroupView=e}angular.module("todo").controller("GroupController",o),o.$inject=["GroupStorage","$scope"]}(),function(){angular.module("todo").service("GroupResource",function(o,t){return o(t.BASE+t.GROUP+":id/",{id:"@id"},{getGroups:{method:"GET",params:{id:null}},getGroup:{method:"GET"},createGroup:{method:"POST"},editGroup:{method:"PUT"},deleteGroup:{method:"DELETE"}})})}(),function(){function o(o,t){function e(e){o({url:e,method:"GET",responseType:"arraybuffer"}).then(function(o){var e="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",r=new Blob([o.data],{type:e}),n=URL.createObjectURL(r);t.open(n)})}return{download:e}}angular.module("downloaders").factory("XlsDownloader",o),o.$inject=["$http","$window"]}(),function(){function o(o,t,e,r,n,u,i,a){function s(){u.group.items.push(u.newTask),u.newTask={},f()}function l(){f(),i.go("groups.list")}function c(){u.group.is_deleted=!0,l()}function p(o){r.deleteItem(o).$promise.then(function(o){m()})}function d(){var o=n.open({templateUrl:"app/views/components/groups/edit-contributors/edit-contributors.html",controller:"EditContributorsController",windowClass:"edit-contributors-modal",resolve:{contributors:function(){return u.group.users}}});o.result.then(function(o){u.group.users=o,f()})}function m(){e.getGroup({id:t}).$promise.then(function(o){u.group=o})}function f(){e.editGroup(u.group).$promise.then(function(o){m()})}function g(){var e=o.BASE+o.EXPORT+"xls/"+t+"/";a.download(e)}m(),u.newTask={},u.addTask=s,u.apply=l,u.deleteGroup=c,u.deleteTask=p,u.editContributors=d,u.updateGroup=f,u.xlsExport=g}angular.module("todo").controller("EditGroupController",o),o.$inject=["API","groupId","GroupResource","ItemResource","$modal","$scope","$state","XlsDownloader"]}(),function(){function o(o,t,e,r){function n(o){_.find(e.contributors,{id:o.id})||e.contributors.push(o)}function u(){t.close(e.contributors)}function i(){t.dismiss("cancel")}function a(o){e.contributors.splice(o,1)}function s(){var o={limit:0,username__icontains:e.username};r.getUsers(o).$promise.then(function(o){e.users=o.objects})}e.contributors=o.slice(),e.addContributor=n,e.apply=u,e.cancel=i,e.deleteContributor=a,e.findUsers=s}angular.module("todo").controller("EditContributorsController",o),o.$inject=["contributors","$modalInstance","$scope","UserResource"]}(),function(){function o(o,t){t.params.limit=10,o.loadData(t.params),t.paginatorConfig={currentPage:1,changePage:function(){var e=t.paginatorConfig.currentPage-1;t.params.offset=e*t.params.limit,o.loadData(t.params)}}}angular.module("todo").controller("GroupListController",o),o.$inject=["GroupStorage","$scope"]}(),function(){function o(o,t){function e(){t.params.offset=t.groups.data.length,o.loadData(t.params)}t.params.limit=50,t.loadData=e,e()}angular.module("todo").controller("GroupPanelController",o),o.$inject=["GroupStorage","$scope"]}(),function(){function o(o){return o.$watch(function(t){return o.masonry.reloadItems(),o.masonry.layout()})}angular.module("nm-widgets").controller("MasonryController",o),o.$inject=["$scope"]}(),function(){function o(o,t,e){var r=t[0],n="";return o.masonry=new Masonry(r,n)}angular.module("nm-widgets").directive("masonry",function(){return{restrict:"A",link:o,controller:"MasonryController"}})}();